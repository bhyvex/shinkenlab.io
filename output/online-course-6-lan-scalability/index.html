<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Online course 6: LAN scalability, adding pollers / Some monitoring guys</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link rel="shortcut icon" href="/theme/favicon16.png" />
    <link rel="apple-touch-icon" href="/theme/favicon32.png.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/favicon48.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/favicon64.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/theme/favicon64.png" />
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700,300italic,300' rel='stylesheet' type='text/css'>

    <!--        <link rel="stylesheet" href="/theme/css/bootstrap.min.css">-->
    
    <script>window.jQuery || document.write('<script src="/theme/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>
      <script src="/theme/js/vendor/modernizr-latest.js"></script>
      <link rel="stylesheet" href="/theme/css/bootstrap.css">
      <!--    <link rel="stylesheet" href="/theme/css/bootstrap-responsive.min.css">-->
      <link rel="stylesheet" href="/theme/css/colorbox.css">
      <link rel="stylesheet" href="/theme/css/main.css">
      <!--        <script src="/theme/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>-->
      <script src="/theme/js/vendor/jquery.lavalamp.js"></script>

      <script src="/theme/js/vendor/respond.min.js"></script> 
      
  </head>
  <body>
    <div id="Web_Map">
      <div class="row">
        <div class="col-sm-3">
          <div class="Content">
            <div class="Logo_Frame">
              <a href="http://shinken-solutions.com" target="_blank"> 
                <img alt="Logo Ninja Solutions Shinken Monitoring" class="Logo" src="/theme/img/ninjagrey.png">
                <p class="Title_Map">shinken-solutions.com</p>
                <p><tiny>Business-centric monitoring</tiny></p>
              </a>    
            </div>
          </div>
        </div>
        <div class="col-sm-3 ">
          <div class="Content">
            <div class="Logo_Frame">
              <a href="http://shinken-monitoring.org" target="_blank">
                <img alt="Logo Ninja Framework Shinken" class="Logo" src="/theme/img/ninjagreen.png">
                <p class="Title_Map">shinken-monitoring.org</p>
                <p>Shinken framework project</p>
              </a>
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="Content">
            <div class="Logo_Frame">
              <a href="http://shinken.io" target="_blank">
                <img alt="Logo Ninja Framework Shinken" class="Logo" src="/theme/img/ninjagreen.png">
                <p class="Title_Map">shinken.io</p>
                <p>Shinken packages platform</p>
              </a>
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="Content">
            <div class="Logo_Frame">
              <a href="http://shinkenlab.io" target="_blank">
                <img alt="Logo Ninja Framework Shinken" class="Logo" src="/theme/img/ninjagreen.png">
                <p class="Title_Map">shinkenlab.io</p>
                <p>Let's discuss about monitoring</p>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <nav class="navbar navbar-default" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://shinkenlab.io">
            <img alt="Logo Solutions Shinken" class="Logo" src="/theme/img/Logoframeworkblack.png">
          </a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav" id="Lavalamp">
            <li>
              <a href="http://shinkenlab.io">Home</a>
            </li>
            <li>
              <a href="http://www.shinken-monitoring.org/">Download</a>
            </li>
            <li>
              <a href="https://shinken.readthedocs.org/en/latest/">Docs</a>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown hide" id="MainDropDown">
              <img alt="Corners Shinken Solutions Dropdown" src="/theme/img/corners.png" id="CornerL">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <span class="caret"></span>
                <img alt="Logo Shinken" src="/theme/img/logomonogrammewhite.png" class="Dropdown_Logo">
              </a>
              <img alt="Corners Shinken Solutions Dropdown" src="/theme/img/corners.png"  id="CornerR">
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!--[if lt IE 7]>
        <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
    <div class="row">
      <div class="col-md-1"></div>
      <div class="container col-md-8">
        <div class="row">
          <div class="span2" id='content'>
          </div> <!-- logo+navigation span -->
          <div class="span10">
            <header id="site-header">
              <h1>
                <a href="">Some monitoring guys</a>
                <small>
                  <span class="divider">/</span> 
                </small>
              </h1>
              <!--<p>
                  
                  </p>-->
            </header>

            <div class="content">
<time datetime="2014-09-08T10:20:00"><div class="DateDay">08</div><span class="DateMounth"> Sep 2014 </span><span class="triangle"></span></time>

<section>
    <article>
        <header>
            <h2><a href="/online-course-6-lan-scalability/" rel="bookmark">Online course 6: LAN scalability, adding pollers</a></h2>
	    <span class='author'>Gab√®s Jean</span>
        </header>
        
    <p>Hi,</p>
<p>This is our 6th online course. After the 5th from <a href="https://twitter.com/Seb_Cvx">Seb</a> that was about creating checks, you got numerous ideas about what to check and make your IT even stronger. But more checks means more load, and maybe one poller is not enough now :)</p>
<p>We will look in this course about one #shinken core feature that will help you there: adding pollers is just tooooo easy :)</p>
<p>Let's start with two standard 2.0 installation in two linux box. We will disable all the daemons on the second box but not the poller.</p>
<p>You will be able to follow this tutorial on video soon.</p>
<h3>Our setup with 2 linux boxes</h3>
<p>We will have 2 linux and we want the second to be just a poller available for the first box shinken. The box courses-a will be our primary one, and courses-b the extended poller one. We just installed shinken in the 2 boxes. Both got a valid dns entry :</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">a</span><span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span>
<span class="p">[...]</span>
<span class="mf">192.168.56.104</span>  <span class="n">courses</span><span class="o">-</span><span class="n">a</span>
<span class="mf">192.168.56.105</span>  <span class="n">courses</span><span class="o">-</span><span class="n">b</span>
<span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span>
<span class="p">[...]</span>
<span class="mf">192.168.56.104</span>  <span class="n">courses</span><span class="o">-</span><span class="n">a</span>
<span class="mf">192.168.56.105</span>  <span class="n">courses</span><span class="o">-</span><span class="n">b</span>
</pre></div>


<p>We want to have something like this :</p>
<p><img src='/images/course6/courses-6-global.png'></p>
<h3>Preparing the first box (master)</h3>
<p>Let's first focus on the <code>courses-a</code> box. This will be quite quick. The poller we want to enable on the <code>courses-b</code> box will have to connect to the <code>scheduler</code> on the <code>courses-a</code> to get its job. It will have the <code>scheduler</code> address and port from a configuration send by the <code>arbiter</code>.</p>
<p>But the default address of the <code>scheduler-master</code> is with the good port (7768), but with the <code>localhost</code> address. This won't be a problem for the arbiter to reach it, but if the poller on the <code>courses-b</code> try, it won't have a change to reach the <code>courses-a scheduler</code> :p</p>
<p>So all we need to do is to setup the LAN address on the <code>scheduler</code> definition object:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">a</span><span class="err">$</span> <span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">schedulers</span><span class="o">/</span><span class="n">scheduler</span><span class="o">-</span><span class="n">master</span><span class="p">.</span><span class="n">cfg</span>
<span class="n">define</span> <span class="n">scheduler</span> <span class="p">{</span>
    <span class="n">scheduler_name</span>      <span class="n">scheduler</span><span class="o">-</span><span class="n">master</span> <span class="p">;</span> <span class="n">Just</span> <span class="n">the</span> <span class="n">name</span>
    <span class="n">address</span>             <span class="n">courses</span><span class="o">-</span><span class="n">a</span>   <span class="p">;</span> <span class="n">IP</span> <span class="n">or</span> <span class="n">DNS</span> <span class="n">address</span> <span class="n">of</span> <span class="n">the</span> <span class="n">daemon</span>
    <span class="n">port</span>                <span class="mi">7768</span>        <span class="p">;</span> <span class="n">TCP</span> <span class="n">port</span> <span class="n">of</span> <span class="n">the</span> <span class="n">daemon</span>
    <span class="n">spare</span>               <span class="mi">0</span>   <span class="p">;</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">is</span> <span class="n">a</span> <span class="n">spare</span><span class="p">,</span> <span class="mi">0</span> <span class="o">=</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">spare</span>

    <span class="n">weight</span>              <span class="mi">1</span>   <span class="p">;</span> <span class="n">Some</span> <span class="n">schedulers</span> <span class="n">can</span> <span class="n">manage</span> <span class="n">more</span> <span class="n">hosts</span> <span class="n">than</span> <span class="n">others</span>
    <span class="n">timeout</span>             <span class="mi">3</span>   <span class="p">;</span> <span class="n">Ping</span> <span class="n">timeout</span>
    <span class="n">data_timeout</span>        <span class="mi">120</span> <span class="p">;</span> <span class="n">Data</span> <span class="n">send</span> <span class="n">timeout</span>
    <span class="n">max_check_attempts</span>  <span class="mi">3</span>   <span class="p">;</span> <span class="n">If</span> <span class="n">ping</span> <span class="n">fails</span> <span class="n">N</span> <span class="n">or</span> <span class="n">more</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="n">node</span> <span class="n">is</span> <span class="n">dead</span>
    <span class="n">check_interval</span>      <span class="mi">60</span>  <span class="p">;</span> <span class="n">Ping</span> <span class="n">node</span> <span class="n">every</span> <span class="n">N</span> <span class="n">seconds</span>
    <span class="n">modules</span>
    <span class="n">realm</span>   <span class="n">All</span>
    <span class="n">skip_initial_broks</span>  <span class="mi">0</span>
    <span class="n">use_ssl</span>          <span class="mi">0</span>
<span class="p">}</span>
</pre></div>


<h3>Now the second box :)</h3>
<p>All we need now it to look at the <code>courses-b</code> box, and let's disable LOT of daemons ^^</p>
<p>You must set <code>daemon_enabled=0</code>to the following files:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="err">$</span> <span class="n">grep</span> <span class="n">daemon_enabled</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">daemons</span><span class="o">/*</span><span class="n">ini</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">daemons</span><span class="o">/</span><span class="n">brokerd</span><span class="p">.</span><span class="n">ini</span><span class="o">:</span><span class="n">daemon_enabled</span><span class="o">=</span><span class="mi">0</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">daemons</span><span class="o">/</span><span class="n">pollerd</span><span class="p">.</span><span class="n">ini</span><span class="o">:</span><span class="n">daemon_enabled</span><span class="o">=</span><span class="mi">1</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">daemons</span><span class="o">/</span><span class="n">reactionnerd</span><span class="p">.</span><span class="n">ini</span><span class="o">:</span><span class="n">daemon_enabled</span><span class="o">=</span><span class="mi">0</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">daemons</span><span class="o">/</span><span class="n">receiverd</span><span class="p">.</span><span class="n">ini</span><span class="o">:</span><span class="n">daemon_enabled</span><span class="o">=</span><span class="mi">0</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">daemons</span><span class="o">/</span><span class="n">schedulerd</span><span class="p">.</span><span class="n">ini</span><span class="o">:</span><span class="n">daemon_enabled</span><span class="o">=</span><span class="mi">0</span>
</pre></div>


<p>And also on the arbiter that is installed by default on the <code>courses-b</code>:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="err">$</span> <span class="n">grep</span> <span class="n">daemon_enabled</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">shinken</span><span class="p">.</span><span class="n">cfg</span>
<span class="n">daemon_enabled</span><span class="o">=</span><span class="mi">0</span>
</pre></div>


<p>Now you can restart your shinken daemons on the <code>courses-b</code> and look if only the poller is really started:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="err">$</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">shinken</span> <span class="o">-</span><span class="n">d</span> <span class="n">restart</span>
<span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="err">$</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">shinken</span> <span class="n">status</span>
<span class="n">Checking</span> <span class="n">status</span> <span class="n">of</span> <span class="n">scheduler</span>
<span class="n">scheduler</span> <span class="n">NOT</span> <span class="n">RUNNING</span>
     <span class="n">failed</span><span class="o">!</span>
<span class="n">Checking</span> <span class="n">status</span> <span class="n">of</span> <span class="n">poller</span>
<span class="n">poller</span> <span class="n">RUNNING</span> <span class="p">(</span><span class="n">pid</span> <span class="mi">25504</span><span class="p">)</span>
<span class="p">.</span> <span class="n">ok</span>
<span class="n">Checking</span> <span class="n">status</span> <span class="n">of</span> <span class="n">reactionner</span>
<span class="n">reactionner</span> <span class="n">NOT</span> <span class="n">RUNNING</span>
     <span class="n">failed</span><span class="o">!</span>
<span class="n">Checking</span> <span class="n">status</span> <span class="n">of</span> <span class="n">broker</span>
<span class="n">broker</span> <span class="n">NOT</span> <span class="n">RUNNING</span>
 <span class="n">failed</span><span class="o">!</span>
 <span class="n">Checking</span> <span class="n">status</span> <span class="n">of</span> <span class="n">receiver</span>
 <span class="n">receiver</span> <span class="n">NOT</span> <span class="n">RUNNING</span>
     <span class="n">failed</span><span class="o">!</span>
 <span class="n">Checking</span> <span class="n">status</span> <span class="n">of</span> <span class="n">arbiter</span>
 <span class="n">arbiter</span> <span class="n">NOT</span> 
     <span class="n">failed</span><span class="o">!</span>
</pre></div>


<p>We temporary put the poller in debug mode so we will have all it's logs available to see the good connexions and internal data.</p>
<p>So now that our <code>courses-b</code> poller is ok and no other daemons will annoy it, we can declare it to the arbiter side on the <code>courses-a</code> server:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">a</span><span class="err">$</span> <span class="n">cp</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">pollers</span><span class="o">/</span><span class="n">poller</span><span class="o">-</span><span class="n">master</span><span class="p">.</span><span class="n">cfg</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">pollers</span><span class="o">/</span><span class="n">poller</span><span class="o">-</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">cfg</span> 
<span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">a</span><span class="err">$</span> <span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">pollers</span><span class="o">/</span><span class="n">poller</span><span class="o">-</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">cfg</span>
<span class="n">define</span> <span class="n">poller</span> <span class="p">{</span>
    <span class="n">poller_name</span>     <span class="n">poller</span><span class="o">-</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span>
    <span class="n">address</span>         <span class="n">courses</span><span class="o">-</span><span class="n">b</span>
    <span class="n">port</span>            <span class="mi">7771</span>
    <span class="n">spare</span>           <span class="mi">0</span>

    <span class="n">manage_sub_realms</span>   <span class="mi">0</span>   <span class="p">;</span> <span class="n">Does</span> <span class="n">it</span> <span class="n">take</span> <span class="n">jobs</span> <span class="n">from</span> <span class="n">schedulers</span> <span class="n">of</span> <span class="n">sub</span><span class="o">-</span><span class="n">Realms</span><span class="o">?</span>
    <span class="n">min_workers</span>         <span class="mi">0</span>   <span class="p">;</span> <span class="n">Starts</span> <span class="n">with</span> <span class="n">N</span> <span class="n">processes</span> <span class="p">(</span><span class="mi">0</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">per</span> <span class="n">CPU</span><span class="p">)</span>
    <span class="n">max_workers</span>         <span class="mi">0</span>   <span class="p">;</span> <span class="n">No</span> <span class="n">more</span> <span class="n">than</span> <span class="n">N</span> <span class="n">processes</span> <span class="p">(</span><span class="mi">0</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">per</span> <span class="n">CPU</span><span class="p">)</span>
    <span class="n">processes_by_worker</span> <span class="mi">256</span> <span class="p">;</span> <span class="n">Each</span> <span class="n">worker</span> <span class="n">manages</span> <span class="n">N</span> <span class="n">checks</span>
    <span class="n">polling_interval</span>    <span class="mi">1</span>   <span class="p">;</span> <span class="n">Get</span> <span class="n">jobs</span> <span class="n">from</span> <span class="n">schedulers</span> <span class="n">each</span> <span class="n">N</span> <span class="n">minutes</span>
    <span class="n">timeout</span>             <span class="mi">3</span>   <span class="p">;</span> <span class="n">Ping</span> <span class="n">timeout</span>
    <span class="n">data_timeout</span>        <span class="mi">120</span> <span class="p">;</span> <span class="n">Data</span> <span class="n">send</span> <span class="n">timeout</span>
    <span class="n">max_check_attempts</span>  <span class="mi">3</span>   <span class="p">;</span> <span class="n">If</span> <span class="n">ping</span> <span class="n">fails</span> <span class="n">N</span> <span class="n">or</span> <span class="n">more</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="n">node</span> <span class="n">is</span> <span class="n">dead</span>
    <span class="n">check_interval</span>      <span class="mi">60</span>  <span class="p">;</span> <span class="n">Ping</span> <span class="n">node</span> <span class="n">every</span> <span class="n">N</span> <span class="n">seconds</span>
    <span class="n">modules</span>
    <span class="n">use_ssl</span>          <span class="mi">0</span>
    <span class="n">realm</span>   <span class="n">All</span>
<span class="p">}</span>
</pre></div>


<p>So the only modification you need are the <code>poller_name</code> and <code>address</code> parameters. You can keep the others by default.</p>
<h3>Restart and look at your success :)</h3>
<p>Then restart the arbiter <code>shinken</code> on the <code>ourses-a</code> server:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">a</span><span class="err">$</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">shinken</span><span class="o">-</span><span class="n">arbiter</span> <span class="n">restart</span>
</pre></div>


<p>The <code>arbiter-master</code> will load the new poller and will give it some new job, like taking checks from the <code>courses-a's scheduler</code> :)</p>
<p>If we look at the <code>courses-b</code> logs, we can see the connexion:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="err">$</span> <span class="n">grep</span> <span class="err">&#39;</span><span class="n">scheduler</span><span class="o">-</span><span class="n">master</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">pollerd</span><span class="p">.</span><span class="n">log</span>
<span class="p">[</span><span class="mi">1410170010</span><span class="p">]</span> <span class="n">INFO</span><span class="o">:</span> <span class="p">[</span><span class="n">Shinken</span><span class="p">]</span> <span class="p">[</span><span class="n">poller</span><span class="o">-</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="p">]</span> <span class="n">Init</span> <span class="n">connection</span> <span class="n">with</span> <span class="n">scheduler</span><span class="o">-</span><span class="n">master</span> <span class="n">at</span> <span class="n">http</span><span class="o">:</span><span class="c1">//courses-b:7768/ (3s,120s)</span>
<span class="p">[</span><span class="mi">1410170010</span><span class="p">]</span> <span class="n">WARNING</span><span class="o">:</span> <span class="p">[</span><span class="n">Shinken</span><span class="p">]</span> <span class="p">[</span><span class="n">poller</span><span class="o">-</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="p">]</span> <span class="n">Scheduler</span> <span class="n">scheduler</span><span class="o">-</span><span class="n">master</span> <span class="n">is</span> <span class="n">not</span> <span class="n">initialized</span> <span class="n">or</span> <span class="n">has</span> <span class="n">network</span> <span class="n">problem</span><span class="o">:</span> <span class="n">Connexion</span> <span class="n">error</span> <span class="n">to</span> <span class="n">http</span><span class="o">:</span><span class="c1">//courses-a:7768/ : couldn&#39;t connect to host</span>
<span class="p">[</span><span class="mi">1410170012</span><span class="p">]</span> <span class="n">INFO</span><span class="o">:</span> <span class="p">[</span><span class="n">Shinken</span><span class="p">]</span> <span class="p">[</span><span class="n">poller</span><span class="o">-</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="p">]</span> <span class="n">Connection</span> <span class="n">OK</span> <span class="n">with</span> <span class="n">scheduler</span> <span class="n">scheduler</span><span class="o">-</span><span class="n">master</span>
<span class="p">[</span><span class="mi">1410170012</span><span class="p">]</span> <span class="n">INFO</span><span class="o">:</span> <span class="p">[</span><span class="n">Shinken</span><span class="p">]</span> <span class="p">[</span><span class="n">poller</span><span class="o">-</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="p">]</span> <span class="n">Init</span> <span class="n">connection</span> <span class="n">with</span> <span class="n">scheduler</span><span class="o">-</span><span class="n">master</span> <span class="n">at</span> <span class="n">http</span><span class="o">:</span><span class="c1">//courses-a:7768/ (3s,120s)</span>
<span class="p">[</span><span class="mi">1410170012</span><span class="p">]</span> <span class="n">INFO</span><span class="o">:</span> <span class="p">[</span><span class="n">Shinken</span><span class="p">]</span> <span class="p">[</span><span class="n">poller</span><span class="o">-</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="p">]</span> <span class="n">Connection</span> <span class="n">OK</span> <span class="n">with</span> <span class="n">scheduler</span> <span class="n">scheduler</span><span class="o">-</span><span class="n">master</span>
</pre></div>


<p>Don't worry about the WARNING here. It's just the poller is too fast for the scheduler to be fully running with a configuration. If you got some few seconds after a <code>Connection OK</code> it means you are ok :)</p>
<p>So now you can look at this poller and look if it really get new checks from the scheduler:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="err">$</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">pollerd</span><span class="p">.</span><span class="n">log</span>
<span class="p">...</span>
<span class="p">[</span><span class="mi">1410170033</span><span class="p">]</span> <span class="n">DEBUG</span><span class="o">:</span> <span class="p">[</span><span class="n">Shinken</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">scheduler</span><span class="o">-</span><span class="n">master</span><span class="p">][</span><span class="n">fork</span><span class="p">]</span> <span class="n">Stats</span><span class="o">:</span> <span class="n">Workers</span><span class="o">:</span><span class="mi">1</span> <span class="p">(</span><span class="n">Queued</span><span class="o">:</span><span class="mi">1</span> <span class="n">TotalReturnWait</span><span class="o">:</span><span class="mi">1</span><span class="p">)</span>
<span class="p">...</span>
</pre></div>


<p>Here the poller ask the scheduler and get one check and one other result to return to this scheduler. You will have one line by worker and by scheduler. So this poller is working great :)</p>
<h3>Did we forgot something?</h3>
<p>But we forgot some things: pollers are launching check plugins, located in the <code>/var/lib/shinken/libexec/</code> directory or in the <code>/usr/lib/nagios/plugins/</code> directory for standard nagios plugins ones. And here you poller got none of them :)</p>
<p>So for each pollers you need to add the same plugins, so for example here you can just :</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="err">$</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">nagios</span><span class="o">-</span><span class="n">plugins</span>
</pre></div>


<p>for the nagios plugins, and:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">a</span><span class="err">$</span> <span class="n">scp</span> <span class="o">-</span><span class="n">rp</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">libexec</span><span class="o">/*</span> <span class="n">root</span><span class="err">@</span><span class="n">courses</span><span class="o">-</span><span class="n">b</span><span class="o">:/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">libexec</span><span class="o">/</span>
</pre></div>


<p>And you will have all you need on the <code>courses-b</code> poller.</p>
<h3>The next course</h3>
<p>The next course will be an extension of this one. Here all checks are distributed in all our pollers, in a round robin way. But maybe we want to dedicate one box for a specific checks or hosts? We will see this in the next course, about the poller tags, and one classic usage for this: pollers in DMZ :)</p>



<p style='border: 2px solid rgba(0,39,59,.2);border-radius: 4px;'><img style='width: 48px;'  data-role="user-avatar" data-user="94550631" src="//a.disquscdn.com/uploads/users/9455/631/avatar92.jpg?1392209481"><a href='#'> jean gab√®s </a>
<a href='mailto:j.gabes@shinken-solutions.com'><img src="/theme/img/Mail.png" /></a>
<a href='https://twitter.com/naparuba'><img src="/theme/img/Twitter.png" /></a>
<a href='http://www.twitch.tv/naparuba'><img src="/theme/img/Twitch.png" /></a>
<a href='https://github.com/naparuba'><img src="/theme/img/GitHub.png" /></a>
</p>
    <div id="FooterArticle">
        <p>Posted in: <a href="/category/talk.html">Talk</a></p>
        <p>Tagged as: <a href="/tag/shinken.html">shinken</a> / <a href="/tag/online-course.html">online course</a> / <a href="/tag/scalability.html">scalability</a></p>
        <p>Wanna tell me what you think? <a href="/">Get in touch.</a></p>
    </div>

<hr/>

<div id="disqus_thread"></div>
  <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'shinkenlabio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    


        </footer>
    </article>
</section>
    <div class="article_infos">
        <p>Posted in: <a href="/category/talk.html">Talk</a></p>
        <p>Tagged as: <a href="/tag/shinken.html">shinken</a> / <a href="/tag/online-course.html">online course</a> / <a href="/tag/scalability.html">scalability</a></p>
    </div>

<!--article.locale_date-->            </div>
            <span id="ScrollTop">
              <img src="/theme/img/caret.png" alt="caret shinken">
            </span>
          </div> <!-- header+content+footer span -->

        </div> <!-- row -->
      </div> <!-- /container -->
      <!--<div class="col-md-1"></div>-->
      <div class="col-md-2">
        <div id="SocialIcons" class="row">
          <a href="https://twitter.com/shinken_monitor"><img src="/theme/img/twitter.png"></a>
          <a href="https://plus.google.com/u/0/+shinken/posts"><img src="/theme/img/google.png"></a>
          <a href="https://github.com/naparuba/shinken/"><img src="/theme/img/github.png"></a>
        </div>
        <div id="Search" class="row">
          <h2>Search</h2>
          <script>
            (function() {
            var cx = '005394482386049038212:vzp97eqtbku';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:search></gcse:search>
        </div>
        <div id="Archives" class="row">
          <a href="/"><h2>Archives</h2></a>
          <div id="LignArticle">
            <div id="Date" datetime="2015-01-30T10:20:00">30 Jan 2015 : </div>
            <a href="/pep8-compliant/">
              PEP8 compatibility
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2015-01-19T10:20:00">19 Jan 2015 : </div>
            <a href="/release-2-2/">
              2.2 release
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2015-01-13T10:20:00">13 Jan 2015 : </div>
            <a href="/news-and-announcements-2015/">
              Some news and announcements for 2015
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-09-08T10:20:00">08 Sep 2014 : </div>
            <a href="/online-course-6-lan-scalability/">
              Online course 6: LAN scalability, adding pollers
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-08-07T00:00:00">07 Aug 2014 : </div>
            <a href="/online-course-5-monitoring-plugins/">
              Online course 5: Monitoring Plugins
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-04-16T10:20:00">16 Apr 2014 : </div>
            <a href="/2-0-release/">
              2.0 release
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-04-08T00:00:00">08 Apr 2014 : </div>
            <a href="/20-rc-last-patch-before-release/">
              2.0 RC: last patch to test :)
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-03-19T10:20:00">19 Mar 2014 : </div>
            <a href="/online-course-4-high-availability/">
              Online course 4: High Availability
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-03-11T10:20:00">11 Mar 2014 : </div>
            <a href="/online-course-3-migration-to-20/">
              Online course 3: 1.4 to 2.0 migration
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-03-07T10:20:00">07 Mar 2014 : </div>
            <a href="/online-course-2-webui/">
              Online course 2: installing WebUI
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-03-04T10:20:00">04 Mar 2014 : </div>
            <a href="/online-course-1-installation/">
              Online course 1: installing shinken 2.0
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-02-17T10:20:00">17 Feb 2014 : </div>
            <a href="/2-0-and-the-project/">
              The 2.0 RC version and the project
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-02-16T10:20:00">16 Feb 2014 : </div>
            <a href="/byebye-wordpress/">
              Byebye wordpress
            </a>
          </div>
        
        </div>
        <hr class="clear">
      </div>
    </div>
    <div class="col-md-1"></div>
    
    <footer id="site-footer">
      <div class="row">
        <div class="col-sm-4">
          <img src="/theme/img/LogoFrameworkWhite.png" alt="Logo Shinken solutions" class="Logo">   
        </div>
        <ul class="col-sm-2 col-xs-6">
          <li>
            <a target="_blank" href="">Home</a>
          </li> 
          <li> 
            <a target="_blank" href="http://shinken-monitoring.org/">Download</a>
          </li>
          <li>
            <a target="_blank" href="https://shinken.readthedocs.org/en/latest/">Docs</a>
          </li> 
        </ul>   
        <ul class="col-sm-2 col-xs-6">
          <li>
            <a target="_blank" href="mailto:naparuba@gmail.com">Contact Us</a>
          </li>
        </ul>                   
        <div class="col-sm-4 col-xs-12">
	  <!--                                <p>2014 ¬© All rights reserved | SAS SHINKEN Solutions | RCS Bordeaux 794 549 543 |</p>-->
        </div>
      </div>

      <!--
          <p>
            <a href="" target="_blank">
              
            </a> Shinken framework team /
            <a href="/">Archives</a>
            / Powered by
            <a href="https://github.com/getpelican/pelican" target="_blank">
              Pelican
            </a>
          </p>
	  -->
    </footer>
    
    <script>
      
      $( document ).ready(function() {


      
      $( "#Menu li a" ).click(function() {
      $(this).next("ul").slideToggle("fast");   
      });   

      // Show Case : Commande la direction des hovers    
      $(function(){
      $(' #da-thumbs > li ').each( function() { $(this).hoverdir(); } );
  });

  $('#Lavalamp').lavalamp({
  easing:"swing",
  duration:300 
  });

  $('.lavalamp-object').css({
  "border-bottom":" 3px solid #ff8400"
  })

  $( ".dropdown" ).click(function() {
  /*$( "#Web_Map" ).slideToggle( "fast");*/
  });


  $( "#Lavalamp li" ).bind('mouseenter', function()  {
  $(this).next(".HoverMenu").slideDown( "fast")
  });

  $( "#Lavalamp li" ).next(".HoverMenu").bind('mouseleave', function()  {
  $(this).slideUp( "fast")
  });


  var HeightSlide = $("#Slide1").innerHeight();
  $( ".Gradient" ).css("height",HeightSlide+"px");

  $( window ).resize(function() {
  var HeightSlide = $("#Slide1").innerHeight();
  $( ".Gradient" ).css("height",HeightSlide+"px");    
  });

  });

</script>
<!--        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->


<!--        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>-->
<script src="/theme/js/vendor/jquery.colorbox-min.js"></script>
<script>$('body').popover || document.write('<script src="/theme/js/vendor/bootstrap.min.js"><\/script>')</script>
  <script src="/theme/js/vendor/jquery.colorbox-min.js"></script>
  <script src="/theme/js/main.js"></script>

  <!--
      <script>
        var _gaq=[['_setAccount','UA-48477803-1'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
      </script>
      -->

  
</body>
</html>