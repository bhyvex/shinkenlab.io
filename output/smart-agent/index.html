<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Smart agent solution / Some monitoring guys</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link rel="shortcut icon" href="/theme/favicon16.png" />
    <link rel="apple-touch-icon" href="/theme/favicon32.png.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/favicon48.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/favicon64.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/theme/favicon64.png" />
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700,300italic,300' rel='stylesheet' type='text/css'>

    <!--        <link rel="stylesheet" href="/theme/css/bootstrap.min.css">-->
    
    <script>window.jQuery || document.write('<script src="/theme/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>
      <script src="/theme/js/vendor/modernizr-latest.js"></script>
      <link rel="stylesheet" href="/theme/css/bootstrap.css">
      <!--    <link rel="stylesheet" href="/theme/css/bootstrap-responsive.min.css">-->
      <link rel="stylesheet" href="/theme/css/colorbox.css">
      <link rel="stylesheet" href="/theme/css/main.css">
      <!--        <script src="/theme/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>-->
      <script src="/theme/js/vendor/jquery.lavalamp.js"></script>

      <script src="/theme/js/vendor/respond.min.js"></script> 
      
  </head>
  <body>
    <div id="Web_Map">
      <div class="row">
        <div class="col-sm-3">
          <div class="Content">
            <div class="Logo_Frame">
              <a href="http://shinken-solutions.com" target="_blank"> 
                <img alt="Logo Ninja Solutions Shinken Monitoring" class="Logo" src="/theme/img/ninjagrey.png">
                <p class="Title_Map">shinken-solutions.com</p>
                <p><tiny>Business-centric monitoring</tiny></p>
              </a>    
            </div>
          </div>
        </div>
        <div class="col-sm-3 ">
          <div class="Content">
            <div class="Logo_Frame">
              <a href="http://shinken-monitoring.org" target="_blank">
                <img alt="Logo Ninja Framework Shinken" class="Logo" src="/theme/img/ninjagreen.png">
                <p class="Title_Map">shinken-monitoring.org</p>
                <p>Shinken framework project</p>
              </a>
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="Content">
            <div class="Logo_Frame">
              <a href="http://shinken.io" target="_blank">
                <img alt="Logo Ninja Framework Shinken" class="Logo" src="/theme/img/ninjagreen.png">
                <p class="Title_Map">shinken.io</p>
                <p>Shinken packages platform</p>
              </a>
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="Content">
            <div class="Logo_Frame">
              <a href="http://shinkenlab.io" target="_blank">
                <img alt="Logo Ninja Framework Shinken" class="Logo" src="/theme/img/ninjagreen.png">
                <p class="Title_Map">shinkenlab.io</p>
                <p>Let's discuss about monitoring</p>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <nav class="navbar navbar-default" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://shinkenlab.io">
            <img alt="Logo Solutions Shinken" class="Logo" src="/theme/img/Logoframeworkblack.png">
          </a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav" id="Lavalamp">
            <li>
              <a href="http://shinkenlab.io">Home</a>
            </li>
            <li>
              <a href="http://www.shinken-monitoring.org/">Download</a>
            </li>
            <li>
              <a href="https://shinken.readthedocs.org/en/latest/">Docs</a>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown hide" id="MainDropDown">
              <img alt="Corners Shinken Solutions Dropdown" src="/theme/img/corners.png" id="CornerL">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <span class="caret"></span>
                <img alt="Logo Shinken" src="/theme/img/logomonogrammewhite.png" class="Dropdown_Logo">
              </a>
              <img alt="Corners Shinken Solutions Dropdown" src="/theme/img/corners.png"  id="CornerR">
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!--[if lt IE 7]>
        <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
    <div class="row">
      <div class="col-md-1"></div>
      <div class="container col-md-8">
        <div class="row">
          <div class="span2" id='content'>
          </div> <!-- logo+navigation span -->
          <div class="span10">
            <header id="site-header">
              <h1>
                <a href="">Some monitoring guys</a>
                <small>
                  <span class="divider">/</span> 
                </small>
              </h1>
              <!--<p>
                  
                  </p>-->
            </header>

            <div class="content">
<time datetime="2015-02-20T10:20:00"><div class="DateDay">20</div><span class="DateMounth"> Feb 2015 </span><span class="triangle"></span></time>

<section>
    <article>
        <header>
            <h2><a href="/smart-agent/" rel="bookmark">Smart agent solution</a></h2>
	    <span class='author'>Jean Gabès</span>
        </header>
        
    <h1>Current pulling monitoring logic limits</h1>
<p>Hi,</p>
<p>Today we will talk about a subject that is in my mind since some months: current monitoring logic and its limits. We are using since long the pull logic, inherited from the old Nagios times. You can use poor monitoring solution like snmp based checks, a one that is a nightmare to maintain like <a href="http://exchange.nagios.org/directory/Addons/Monitoring-Agents/NRPE--2D-Nagios-Remote-Plugin-Executor/details">NRPE</a> or more advanced checks like <a href="https://github.com/naparuba/check-linux-by-ssh">my ssh based ones</a>. But in the end it's mainly a protocol change, the pulling logic is the same.</p>
<p>That's why shinken is able to have so much pollers, to allow you to launch as much checks as you want. It works. Even on large IT if you have enough pollers you will be able to monitor what you want. But maybe it's not the most efficient way to do.</p>
<p>Let's look at a simple picture about our two majors monitoring problems:</p>
<p><center><img src='/images/smartagent/problems.png'></center></p>
<h3>Plugin consumption</h3>
<p>The first problem is the plugins consumption. In the most large Shinken setups, I did see overload pollers. But it was not the poller daemons that use all the CPUs. No. It was always the plugins. And especially vmware and Windows ones (the SOAP and WMI protocols are just too heavy). Of course you can just add new CPUs, but we should try to find a smarter solution that just adding more and more CPUs each time you are adding new servers.</p>
<p>This consumption is limiting us to the classic 5 minutes monitoring interval between checks. Some folks monitor some cluster each 10s, but only for a limited scope.</p>
<h3>Need for more elasticity</h3>
<p>The second problem is more recent. With all the Cloud based usage (I link together EC2, Openstack and Docker in this group) the elasticity became more critical than huge performances. You want your new EC2 node to be monitored as soon as it's ready, not 1 hour after. Because maybe its livespan is less than this! </p>
<p>Some frameworks like <a href="http://kubernetes.io/">kubernetes</a> can help, but such tools are quite complex and we should be able to provide more simple solutions to common cases.</p>
<h1>My solution</h1>
<h3>Smart agent</h3>
<p>During years, agentless monitoring was king. Because polling was acceptable from a CPU point of view, and elasticity was an exception, not the rule. Managing agents was a nightmare because they did only follow central server questions and did not try to be smart (believe me, NRPE is NOT smart at all).</p>
<p>But if you have a smart agent, that not just launch a check when ask, but instead try to detect the server "tags" where it is installed, where it can collect both system and applications properties and metrics (think about public ip and mysql load for example), and checks that are using such data. Then such a agent can be a great asset for your monitoring platform.</p>
<h3>No more plugins problems</h3>
<p>The agent can schedule its own checks, and will forward to shinken only the state changes. With such a low brandwith system, you can launch far more checks than now, and launching every checks at 10s interval will be possible.</p>
<h3>Huge elasticity</h3>
<p>For the second problem (lack of elasticity), when the agent is launched and did detect which OS and which applications are on the server, it can declare itself to shinken. And when it's going down, it can also inform shinken too.</p>
<h3>How the agent works</h3>
<p>You can have a look at such system on this picture:</p>
<p><center><img src='/images/smartagent/agent.png'></center></p>
<p>There are 3 main parts:</p>
<ul>
<li>The detector detects the server and the applications running on it</li>
<li>The collectors grab data from both the system and the applications</li>
<li>The analyser launchs checks that look if all is well on both your system and your applications</li>
</ul>
<p>The key in separate collctors and checks is that you don't have to keep the same interval betweek collect and checks.</p>
<h3>Configuration managment</h3>
<p>Of course the local configuration did made NRPE-like solution nightmare to maintain. That's why I propose to use the solution that I already propose in <a href="http://shinken-solutions.com">Shinken Enterprise</a>: do not manage the configuration in a definition way, but in a rule base one. For example:</p>
<ul>
<li>is redis installed on your system? =&gt; you are a redis server</li>
<li>is it a windows running? =&gt; activate windows collectors and checks</li>
<li>is you public ip in the EC2-East range? =&gt; warn the good administrators</li>
<li>...</li>
</ul>
<p>With such a way, all agents will have the same rules, but will behave localy like they should.</p>
<p>In the end the solution is quite great: when you add the agent on your servers, you don't need to manage your configuration anymore!</p>
<p><center><img src='/images/smartagent/global.png'></center></p>
<ul>
<li>You are launching a new server? It will be declare in few seconds into shinken with the good tags (windows,iis for example)</li>
<li>You will reduce a lot the number of pollers in your setups or increase a lot your networking mononitoring interval.</li>
<li>"Out of the box" monitoring with the good detector and collectors rules :)</li>
</ul>
<h1>Feed backs welcomed :)</h1>
<p>You can't solve all your monitoring with agent, like you can't solve all with just polling. You must use both to have a complete and scalable solution.</p>
<p>This is currently a work in progress, I'm proposing such ideas. I'm very interested about your comments about all of this (づ｡◕‿‿◕｡)づ </p>
<p></br></p>



<p style='border: 2px solid rgba(0,39,59,.2);border-radius: 4px;'><img style='width: 48px;'  data-role="user-avatar" data-user="94550631" src="//a.disquscdn.com/uploads/users/9455/631/avatar92.jpg?1392209481"><a href='#'> jean gabès </a>
<a href='mailto:j.gabes@shinken-solutions.com'><img src="/theme/img/Mail.png" /></a>
<a href='https://twitter.com/naparuba'><img src="/theme/img/Twitter.png" /></a>
<a href='http://www.twitch.tv/naparuba'><img src="/theme/img/Twitch.png" /></a>
<a href='https://github.com/naparuba'><img src="/theme/img/GitHub.png" /></a>
</p>
    <div id="FooterArticle">
        <p>Posted in: <a href="/category/talk.html">Talk</a></p>
        <p>Tagged as: <a href="/tag/shinken.html">shinken</a> / <a href="/tag/agent.html">agent</a></p>
        <p>Wanna tell me what you think? <a href="/">Get in touch.</a></p>
    </div>

<hr/>

<div id="disqus_thread"></div>
  <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'shinkenlabio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    


        </footer>
    </article>
</section>
    <div class="article_infos">
        <p>Posted in: <a href="/category/talk.html">Talk</a></p>
        <p>Tagged as: <a href="/tag/shinken.html">shinken</a> / <a href="/tag/agent.html">agent</a></p>
    </div>

<!--article.locale_date-->            </div>
            <span id="ScrollTop">
              <img src="/theme/img/caret.png" alt="caret shinken">
            </span>
          </div> <!-- header+content+footer span -->

        </div> <!-- row -->
      </div> <!-- /container -->
      <!--<div class="col-md-1"></div>-->
      <div class="col-md-2">
        <div id="SocialIcons" class="row">
          <a href="https://twitter.com/shinken_monitor"><img src="/theme/img/twitter.png"></a>
          <a href="https://plus.google.com/u/0/+shinken/posts"><img src="/theme/img/google.png"></a>
          <a href="https://github.com/naparuba/shinken/"><img src="/theme/img/github.png"></a>
        </div>
        <div id="Search" class="row">
          <h2>Search</h2>
          <script>
            (function() {
            var cx = '005394482386049038212:vzp97eqtbku';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:search></gcse:search>
        </div>
        <div id="Archives" class="row">
          <a href="/"><h2>Archives</h2></a>
          <div id="LignArticle">
            <div id="Date" datetime="2015-02-20T10:20:00">20 Feb 2015 : </div>
            <a href="/smart-agent/">
              Smart agent solution
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2015-02-12T10:20:00">12 Feb 2015 : </div>
            <a href="/kernel-shinken-io/">
              kernel.shinken.io
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2015-02-11T10:20:00">11 Feb 2015 : </div>
            <a href="/governance/">
              Governance
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2015-01-30T10:20:00">30 Jan 2015 : </div>
            <a href="/pep8-compliant/">
              PEP8 compatibility
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2015-01-19T10:20:00">19 Jan 2015 : </div>
            <a href="/release-2-2/">
              2.2 release
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2015-01-13T10:20:00">13 Jan 2015 : </div>
            <a href="/news-and-announcements-2015/">
              Some news and announcements for 2015
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-09-08T10:20:00">08 Sep 2014 : </div>
            <a href="/online-course-6-lan-scalability/">
              Online course 6: LAN scalability, adding pollers
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-08-07T00:00:00">07 Aug 2014 : </div>
            <a href="/online-course-5-monitoring-plugins/">
              Online course 5: Monitoring Plugins
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-04-16T10:20:00">16 Apr 2014 : </div>
            <a href="/2-0-release/">
              2.0 release
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-04-08T00:00:00">08 Apr 2014 : </div>
            <a href="/20-rc-last-patch-before-release/">
              2.0 RC: last patch to test :)
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-03-19T10:20:00">19 Mar 2014 : </div>
            <a href="/online-course-4-high-availability/">
              Online course 4: High Availability
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-03-11T10:20:00">11 Mar 2014 : </div>
            <a href="/online-course-3-migration-to-20/">
              Online course 3: 1.4 to 2.0 migration
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-03-07T10:20:00">07 Mar 2014 : </div>
            <a href="/online-course-2-webui/">
              Online course 2: installing WebUI
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-03-04T10:20:00">04 Mar 2014 : </div>
            <a href="/online-course-1-installation/">
              Online course 1: installing shinken 2.0
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-02-17T10:20:00">17 Feb 2014 : </div>
            <a href="/2-0-and-the-project/">
              The 2.0 RC version and the project
            </a>
          </div>
          <div id="LignArticle">
            <div id="Date" datetime="2014-02-16T10:20:00">16 Feb 2014 : </div>
            <a href="/byebye-wordpress/">
              Byebye wordpress
            </a>
          </div>
        
        </div>
        <hr class="clear">
      </div>
    </div>
    <div class="col-md-1"></div>
    
    <footer id="site-footer">
      <div class="row">
        <div class="col-sm-4">
          <img src="/theme/img/LogoFrameworkWhite.png" alt="Logo Shinken solutions" class="Logo">   
        </div>
        <ul class="col-sm-2 col-xs-6">
          <li>
            <a target="_blank" href="">Home</a>
          </li> 
          <li> 
            <a target="_blank" href="http://shinken-monitoring.org/">Download</a>
          </li>
          <li>
            <a target="_blank" href="https://shinken.readthedocs.org/en/latest/">Docs</a>
          </li> 
        </ul>   
        <ul class="col-sm-2 col-xs-6">
          <li>
            <a target="_blank" href="mailto:naparuba@gmail.com">Contact Us</a>
          </li>
        </ul>                   
        <div class="col-sm-4 col-xs-12">
	  <!--                                <p>2014 © All rights reserved | SAS SHINKEN Solutions | RCS Bordeaux 794 549 543 |</p>-->
        </div>
      </div>

      <!--
          <p>
            <a href="" target="_blank">
              
            </a> Shinken framework team /
            <a href="/">Archives</a>
            / Powered by
            <a href="https://github.com/getpelican/pelican" target="_blank">
              Pelican
            </a>
          </p>
	  -->
    </footer>
    
    <script>
      
      $( document ).ready(function() {


      
      $( "#Menu li a" ).click(function() {
      $(this).next("ul").slideToggle("fast");   
      });   

      // Show Case : Commande la direction des hovers    
      $(function(){
      $(' #da-thumbs > li ').each( function() { $(this).hoverdir(); } );
  });

  $('#Lavalamp').lavalamp({
  easing:"swing",
  duration:300 
  });

  $('.lavalamp-object').css({
  "border-bottom":" 3px solid #ff8400"
  })

  $( ".dropdown" ).click(function() {
  /*$( "#Web_Map" ).slideToggle( "fast");*/
  });


  $( "#Lavalamp li" ).bind('mouseenter', function()  {
  $(this).next(".HoverMenu").slideDown( "fast")
  });

  $( "#Lavalamp li" ).next(".HoverMenu").bind('mouseleave', function()  {
  $(this).slideUp( "fast")
  });


  var HeightSlide = $("#Slide1").innerHeight();
  $( ".Gradient" ).css("height",HeightSlide+"px");

  $( window ).resize(function() {
  var HeightSlide = $("#Slide1").innerHeight();
  $( ".Gradient" ).css("height",HeightSlide+"px");    
  });

  });

</script>
<!--        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->


<!--        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>-->
<script src="/theme/js/vendor/jquery.colorbox-min.js"></script>
<script>$('body').popover || document.write('<script src="/theme/js/vendor/bootstrap.min.js"><\/script>')</script>
  <script src="/theme/js/vendor/jquery.colorbox-min.js"></script>
  <script src="/theme/js/main.js"></script>

  <!--
      <script>
        var _gaq=[['_setAccount','UA-48477803-1'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
      </script>
      -->

  
</body>
</html>